'use strict';

//Main Quiz class using the Module Pattern
const Quiz = (function() {
    //Private variables
    const state = {
        currentQuestion: 1,
        answers: new Map(),
        totalQuestions: 5
    };

    //Cache DOM elements
    const elements = {
        app: document.getElementById('app'),
        progress: document.getElementById('progress'),
        questionContainer: document.getElementById('question-container'),
        result: document.getElementById('result'),
    };

    //Question data
    const questions = [
        {
            id: 1,
            text: "When faced with a challenge, you usually:",
            options: [
                { id: A, text: "Take time to paln carefully" },
                { id: B, text: "AAct quickly on instinct" },
                { id: C, text: "Seekadvice from others" },
                { id: D, text: "Find creative solutions" }
            ],
        },
        {
            id: 2,
            text: "In your free time, you prefer to:",
            options: [
                { id: A, text: "Read or study something new" },
                { id: B, text: "Go for a walk" },
                { id: C, text: "Meet up with friends" },
                { id: D, text: "Work on a hobby or creative project" }
            ],
        },
        {
            id: 3,
            text: "Your ideal environment is:",
            options: [
                { id: A, text: "A quiet, organized space" },
                { id: B, text: "The great outdoors" },
                { id: C, text: "A lively social setting" },
                { id: D, text: "An inspiring workspace" }
            ],
        },
        {
            id: 4,
            text: "When making decisions, you rely most on:",
            options: [
                { id: A, text: "Logic and reason" },
                { id: B, text: "Your gut instinct and experience" },
                { id: C, text: "Feedback and feelings from others" },
                { id: D, text: "Innovation and possibilities" }
            ],
        },
        {
            id: 5,
            text: "In a group project, you naturally:",
            options: [
                { id: A, text: "Organize and plan everything" },
                { id: B, text: "Take the lead and delegate tasks" },
                { id: C, text: "Listen to others and build consensus" },
                { id: D, text: "Bring unique ideas" }
            ],
        
        }
    ]
})

//Personality data
const personalities = {
    'A': {
        animal: 'Owl',
        traits: {
            'wisdom': 95,
            'analysis': 90,
            'patience': 85,
            'organization': 88
        },
        details: "As an Owl personality you excel in analytical thinking and strategic planning. Your greatest strengths lie in your ability to process complex information and make well-informed decisions. You have a natural talent for research and problem-solving.",
        compatability: {
            'Fox': 'Great intellectual synergy',
            'Wolf': 'Strong leadership dynamic',
            'Dolphin': 'Balanced perspective paetnership',
        }
    },
    'B': {
        animal: 'Wolf',
        traits: {
            'Leadership': 92,
            'Courage': 88,
            'Loyalty': 95,
            'Determination': 90
        },
        details: "With your Wolf personality, you're a natural leader who inspires others through action. Your desicisivenessand courage make you excellent in crisis management and team leadership. You have a strong protective instinct for your loved ones.",
        compatability: {
            'Owl': 'Strategic alliance',
            'Dolphin': 'Dynamic team combination',
            'Fox': 'Creative leadershippair',
        }
    },
    'C': {
        animal: 'Dolphin',
        traits: {
            'Empathy': 95,
            'Social Skills': 92,
            'Playfulness': 88,
            'Communincation': 90
        },
        details: "Your Dolphin personality shines through your exceptional social skills and emotional intelligence. You're naturally gifted at bringing people together and creating harmony in groups. Your playful nature makes you approachable and trustworthy.",
        compatability: {
            'Wolf': 'Balanced leadership duo',
            'Fox': 'Creative social pair',
            'Owl': 'Thoughout communication match',
        }
    },
    'D': {
        animal: 'Fox',
        traits: {
            'Creativity': 94,
            'Intelligence': 88,
            'Adaptability': 92,
            'Innovation': 90
        },
        details: "As a Fox personality, your creative thinking and adaptability set you apart. You excel at finding innovative solutions and thinking outside the box. Your quick wit and charm make you excellent at navigating complex situations.",
        compatability: {
            'Owl': 'Innovative problem-solving duo',
            'Dolphin': 'Socially creative partnership',
            'Wolf': 'Dynamic creative team'
        }
    }
};

//Private methods
const updateProgress = () => {
    const progress = (state.currentQuestion - 1) / state.totalQuestions * 100;
    elements.progress.setProperty('--progress', `${progress}%`);
    document.getElementById('current-question').textContent = state.currentQuestion;
};

const renderQuestion = (questionId) => {
    const question = questions.find(q => q.id === questionId);
    const template = document.getElementsById('question-template').content.cloneNode(true);
   
    //Set up question
    template.querySelector('.question').dataset.questioinId = question.id;
    template.querySelector('.question-text').textContent = question.text;

    //Set up options
    const optionsContainer = template.querySelector('.options-grid');
    question.options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'options-button';
        button.textContent = option.text;
        button.dataset.optionId = option-id;
        button.addEventListener('click', () => handleAnswer(option.id));
        optionsContainer.appendChild(button)
    });

    elements.questionContainer.innerHTML = '';
    elements.questionContainer.appendChild(template);
};

//Public methods
return {
    init() {
        renderQuestion(1);
        updateProgress();
    },
    handleAnswer(optionId) {
        state.answers.set(state.currentQuestion, optionId);
        if (state.currentQuestion < state.totalQuestions) {
            state.currentQuestion++;
            renderQuestion(state.currentQuestion)
            updateProgress();
        }
        else {
            this.showResult();
        }
    },
    showResult() {
        //Calculate result
        const result = this.calculateResult();

        //Render result using template
        const template = document.getElementById('result-template').content.cloneNode(true);

        //Populate template
        template.querySelector('.animal-type').textContent = personalities[result].animal

        //Add result content
        elements.result.innerHTML = '';
        elements.result.appendChild(template);

        //Show result section
        elements.questionContainer.classList.add('hidden');
        elements.result.classList.add('hidden')
    },
    calculateResult() {
        // Calculate most frequent answer
        const counts = new Map();
        state.answer.forEach(answer => {
            counts.set(answer, (counts.get(answer) || 0) + 1);
        });
        return Array.from(counts.entries()).reduce((a, b) => b[1] > a[1] ? b : a)[0];
    }
}();

// Initialize quiz when DOM is ready 
document.addEventListener('DOMContentLoaded', () => Quiz.init());

// Service Worker regisration for PWA support
if ('ServiceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
        .then(registraton => console.log('ServiceWorker registered'))
        .catch(err => console.log('ServiceWorker registration failed:', err));
    });
}







